/* Auto-split from style.css — do not edit here if you still maintain the monolith. */
/* Section: gameplay */

:root{
  /* единая геометрия левой колонки */
  --left-gap: 16px;
  --pm-w: 240px;   /* "Управление игроками" */
  /* чуть уже, чтобы карточки игроков визуально были подогнаны под кнопки */
  --pl-w: 282px;   /* "Пользователи и персонажи" + "Очередность хода" */
  --dice-w: var(--pm-w);
}

/* Левая панель: журнал + управление + инициатива (в одну строку) */
#action-log-container {
  display: flex;
  flex-direction: column;
  gap: var(--left-gap);
  width: calc(var(--pm-w) + var(--pl-w) + var(--left-gap));
}

#action-log {
  max-height: 200px;
}

#start-initiative.active {
  background-color: red;
  color: white;
}

#start-initiative.ready {
  background-color: green;
  color: white;
}

/* Оранжевая подсветка: можно начинать бой */
#start-combat.pending {
  background-color: orange;
  color: black;
}

#start-combat.ready {
  background-color: green;
  color: white;
}

/* ===== Очередность хода (над полем) ===== */
.turn-order-box{
  width: 100%;
  max-width: none;
  padding: 8px 10px;
  border: 1px solid #444;
  border-radius: 10px;
  background: rgba(18,18,18,0.92);
  margin-bottom: 10px;
}

.turn-order-head{
  display: flex;
  align-items: baseline;
  justify-content: space-between;
  gap: 12px;
  margin-bottom: 6px;
}

.turn-order-title{
  font-weight: 700;
}

.turn-order-round{
  font-size: 12px;
  opacity: 0.85;
}

.turn-order-list{
  list-style: none;
  padding: 0;
  margin: 0;
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.turn-order-item{
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  padding: 4px 6px;
  border-radius: 8px;
  border: 1px solid rgba(255,255,255,0.08);
}

.turn-order-item.is-current{
  border-color: rgba(255,165,0,0.7);
  background: rgba(255,165,0,0.12);
}

.turn-order-item.is-pending{
  opacity: 0.6;
}

.lss-pill{
  display:flex;
  align-items:center;
  gap:6px;            /* ⬅ меньше */
  border:1px solid rgba(255,255,255,0.16);
  background:rgba(0,0,0,0.15);
  border-radius:10px;
  padding:4px 6px;    /* ⬅ меньше высота "Проверка/Спасбросок" */
}

/* label + иконки (кубик / владение спасброском) */
.lss-pill-label-row{
  display:flex;
  align-items:center;
  gap:6px;
}

.lss-dice-btn{
  border:1px solid rgba(255,255,255,0.14);
  background:rgba(255,255,255,0.06);
  border-radius:8px;
  padding:2px 4px;
  line-height:0;
  cursor:pointer;
  color:rgb(155,155,155);
}

.lss-dice-btn:hover{
  background:rgba(255,255,255,0.10);
  border-color:rgba(255,255,255,0.20);
}

.lss-dice-btn:active{
  transform:translateY(1px);
}

/* кружок владения спасброском (2 состояния) */
.lss-save-dot{
  width:12px;
  height:12px;
  border-radius:999px;
  border:2px solid rgba(255,255,255,0.25);
  background:transparent;
  flex:0 0 auto;
  padding:0;
}

/* ===== PATCH: инпуты для характеристик/проверок/спасбросков/навыков ===== */
.lss-ability-score-input{
  width: 64px;
  text-align: right;
  font-weight: 900;
  font-size: 16px;
  line-height: 18px;
  color: #fff;
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.14);
  border-radius: 10px;
  padding: 2px 8px;
}

.spell-attack-input{
  width: 64px;          /* как у "СЛ спасброска" по компактности */
  min-width: 64px;
  padding: 4px 8px;
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.16);
  background: rgba(0,0,0,0.18);
  color: inherit;
  font-size: 18px;
  line-height: 1;
  text-align: center;
  font-weight: 700;
}

/* ===== Combat / Weapons UI ===== */
.combat-toolbar{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}

.weapon-dice{ width:90px; }

/* ================== DICE STACK (bottom-left) ================== */
.dice-stack{
  position: fixed;
  /* выравниваем по тем же отступам, что и основной интерфейс (body margin) */
  left: 20px;
  bottom: 20px;
  width: var(--dice-w);
  display: flex;
  flex-direction: column;
  gap: 8px;
  z-index: 9998;
}

.dice-viz{
  position: relative;
  width: var(--dice-w);
  padding: 6px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,.14);
  background: rgba(20,20,20,0.92);
  box-shadow: 0 10px 30px rgba(0,0,0,0.55);
  user-select: none;
}

.dice-viz-title{
  font-weight: 900;
  font-size: 12px;
  margin-bottom: 4px;
}

.dice-viz-controls{
  display: flex;
  flex-wrap: wrap;            /* разрешаем перенос строки */
  gap: 8px;
  align-items: flex-start;     /* чтобы “Инициатива” не тянула высоту */
  margin-bottom: 6px;
}

/* Инициатива — отдельной строкой, влезает в рамку */
.dice-viz-btn--initiative{
  order: 0;
  flex: 1 0 100%;     /* занимает всю ширину */
  width: 100%;
  margin-bottom: 0;
}

/* Селект, количество, “Бросить” — следующей строкой */
.dice-viz-select{ order: 1; }

.dice-viz-count{ order: 2; }

#roll{
  order: 3;
  flex: 1 1 auto;     /* занимает остаток строки */
  min-width: 88px;    /* чтобы не схлопывалась */
}

.dice-viz-select,
.dice-viz-count{
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.18);
  color: #fff;
  padding: 7px 10px;
  outline: none;
}

.dice-viz-select{ width: 72px; font-size: 12px; padding: 6px 8px; }

.dice-viz-count{ width: 62px; font-size: 12px; padding: 6px 8px; }

/* Кнопка Инициатива — отдельной строкой внутри панели */
.dice-viz-btn--initiative{
  width: 100%;
  display: block;
  margin-bottom: 8px;
}

.dice-viz-btn{
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,.18);
  background: rgba(255,255,255,.08);
  color: #fff;
  padding: 7px 8px;
  font-weight: 900;
  font-size: 12px;
  cursor: pointer;
}

/* Инициатива — отдельной строкой, внутри панели */
.dice-viz-btn--initiative{
  width: 100%;
  display: block;
  margin-bottom: 8px;
}

/* Строка броска — строго в одну линию */
.dice-viz-controls{
  display: flex;
  gap: 8px;
  align-items: center;
  flex-wrap: nowrap;     /* важно */
}

/* Кнопка "Бросить" занимает остаток строки после количества */
.dice-viz-btn--roll{
  flex: 1 1 auto;
  min-width: 88px;
  padding: 7px 10px;     /* чуть компактнее, чтобы точно влезала */
}

/* ===== Dark dropdown (options list) ===== */
.weapon-select,
.dice-viz-select{
  color-scheme: dark;            /* важно: делает нативную шторку тёмной (где поддерживается) */
}

.weapon-select option,
.dice-viz-select option,
.weapon-select optgroup,
.dice-viz-select optgroup{
  background: #1e1e1e;           /* тёмно-серый фон шторки */
  color: #ffffff;                /* белый текст */
}

.dice-viz-btn:disabled{ opacity: .55; cursor: not-allowed; }

/* ===== Initiative choice (new player during combat) ===== */
.init-choice-box{
  display: flex;
  flex-direction: column;
  gap: 6px;
  padding: 0;
  margin-bottom: 6px;
}

#dice-canvas{
  /* уже/выше — чтобы кубик не вылезал за границы рамки "Бросок" */
  width: 208px;
  height: 96px;
  display: block;
  margin: 0 auto;
  border-radius: 12px;
  background: rgba(255,255,255,0.03);
  border: 1px solid rgba(255,255,255,0.10);
}

/* ===== Other players dice feed (inline, above dice panel) ===== */
.dice-others.dice-others--inline{
  position: relative;
  left: auto;
  bottom: auto;
  width: var(--dice-w);
  padding: 8px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,0.14);
  background: rgba(20,20,20,0.88);
  box-shadow: 0 10px 30px rgba(0,0,0,0.55);
  z-index: 9997;
  pointer-events: none;
}

.dice-others.dice-others--inline .dice-others__title{
  font-size: 12px;
  margin-bottom: 6px;
}

.dice-viz-rolls{
  margin-top: 8px;
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  min-height: 26px;
}

.dice-chip{
  padding: 4px 8px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.18);
  font-size: 12px;
  font-weight: 800;
  opacity: .95;
}

.dice-chip.active{
  border-color: rgba(255,165,0,.55);
  box-shadow: 0 0 0 2px rgba(255,165,0,.14);
}

.dice-viz-meta{
  margin-top: 8px;
  display: flex;
  justify-content: space-between;
  gap: 10px;
  font-weight: 900;
}

/* ===== Dice Panel (bottom-left) ===== */
.dice-panel{
  position: fixed;
  left: 14px;
  bottom: 14px;
  width: 270px;
  padding: 10px;
  border-radius: 12px;
  border: 1px solid #444;
  background: rgba(20,20,20,0.92);
  box-shadow: 0 10px 30px rgba(0,0,0,0.55);
  z-index: 9998;
  user-select: none;
}

.dice-panel__title{
  font-weight: 900;
  font-size: 13px;
  color: #fff;
  margin-bottom: 8px;
}

.dice-panel__row{
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 8px;
}

.dice-panel__label{
  width: 54px;
  font-size: 12px;
  opacity: 0.85;
}

.dice-panel__select,
.dice-panel__count{
  flex: 1;
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.18);
  background: rgba(255,255,255,0.06);
  color: #fff;
  padding: 6px 8px;
  outline: none;
}

.dice-panel__count{
  flex: 0 0 70px;
}

.dice-panel__btn{
  flex: 1;
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.22);
  background: rgba(255,255,255,0.08);
  color: #fff;
  padding: 7px 10px;
  font-weight: 900;
  cursor: pointer;
}

#dice-canvas{
  /* единый размер (не даём визуализации вылезать за рамки) */
  width: 208px;
  height: 96px;
  display: block;
  margin: 0 auto;
  border-radius: 12px;
  background: rgba(255,255,255,0.03);
  border: 1px solid rgba(255,255,255,0.10);
}

.dice-panel__meta{
  margin-top: 8px;
  display: flex;
  justify-content: space-between;
  font-weight: 900;
}

/* ===== Combat / Weapons (v2 compact) ===== */
.weapons-list{
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 10px;
}

.weapon-dice-btn{
  width: 22px;
  height: 22px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  border-radius: 8px;
  border: 1px solid rgba(255,165,0,.38);
  background: rgba(255,165,0,.12);
  color: rgba(255,165,0,.95);
  cursor: pointer;
  padding: 0;

  /* ✅ ключевое: SVG не вылезает и кнопка не сжимается */
  overflow: auto;
  flex: 0 0 auto;
  line-height: 0;
}

.weapon-dice-btn svg{
  width: 12px;
  height: 12px;
  display: block;
}

.weapon-dice-btn:hover{
  background: rgba(255,165,0,.18);
}

.weapon-dice-btn:active{
  transform: translateY(1px);
}

.weapon-dmg-mini .weapon-dice{ width: 86px; }

.combat-skills-card{ margin-top: 10px; }

.combat-skills-text{ width: 100%; resize: vertical; }

/* ===== d20 crit highlight (only pure d20) ===== */
#dice-viz-value.crit-fail,
.dice-chip.crit-fail{
  color: #ff4d4d;
  font-weight: 900;
}

#dice-viz-value.crit-success,
.dice-chip.crit-success{
  color: #ffa500;
  font-weight: 900;
}

/* ===== Other players dice feed ===== */
.dice-others{
  position: fixed;
  left: 300px;      /* legacy fallback (если блок вне стека) */
  bottom: 14px;
  width: var(--dice-w);
  padding: 10px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,0.14);
  background: rgba(20,20,20,0.88);
  box-shadow: 0 10px 30px rgba(0,0,0,0.55);
  z-index: 9997;
  pointer-events: none;
}

/* Внутри .dice-stack — встает НАД панелью "Бросок" */
.dice-others--inline{
  position: relative;
  left: auto;
  bottom: auto;
  width: var(--dice-w);
  padding: 8px;
  max-height: 150px;
  overflow: hidden;
}

.dice-others__list{
  display: flex;
  flex-direction: column;
  justify-content: flex-end; /* новые броски снизу */
  gap: 8px;
  height: 118px;
}

.dice-others__title{
  font-weight: 900;
  font-size: 12px;
  margin-bottom: 8px;
  opacity: .9;
}

.dice-others__item{
  border: 1px solid rgba(255,255,255,0.12);
  background: rgba(0,0,0,0.18);
  border-radius: 12px;
  padding: 8px 10px;
  margin: 0;
  opacity: .98;
  transition: opacity .9s ease, transform .9s ease;
  animation: diceRise .18s ease-out;
}

.dice-others__head{
  font-weight: 900;
  font-size: 12px;
  margin-bottom: 4px;
  opacity: .95;
}

.dice-others__body{
  font-weight: 800;
  font-size: 12px;
  opacity: .9;
}

.dice-others__item.fade{
  opacity: 0;
  transform: translateY(-16px);
}

@keyframes diceRise{
  from{ opacity: .2; transform: translateY(10px); }
  to{ opacity: .98; transform: translateY(0); }
}

/* крит подсветка */
.dice-others__item.crit-fail{ border-color: rgba(255,77,77,0.55); }

.dice-others__item.crit-success{ border-color: rgba(255,165,0,0.60); }

/* если экран узкий — прячем, чтобы не мешало */
@media (max-width: 700px){
  .dice-others{ display:none; }
}

/* ===== Dice panel: actions column ===== */
.dice-viz-actions{
  position: absolute;     /* ⬅️ ВАЖНО: больше не влияет на ширину панели */
  right: 10px;
  top: -12px;             /* ⬅️ чуть заезжает над полем количества */
  display: flex;
  flex-direction: column;
  gap: 6px;
  z-index: 2;
}

/* Initiative button: same as roll button, but can glow when active */
.dice-viz-btn--initiative.is-active{
  border-color: rgba(80, 200, 120, .55);
  background: rgba(80, 200, 120, .18);
  box-shadow: 0 0 0 2px rgba(80, 200, 120, .10) inset;
  padding: 6px 10px;
  font-size: 13px;
}

/* ===== Spells: dice button (blue) ===== */
.spell-metric-label-row{
  display: inline-flex;
  align-items: center;
  gap: 6px;
}

.spell-dice-btn{
  width: 22px;
  height: 22px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  border-radius: 8px;
  border: 1px solid rgba(80,170,255,.45);
  background: rgba(80,170,255,.16);
  color: rgba(110,195,255,.95);
  cursor: pointer;
  padding: 0;
  overflow: auto;
  flex: 0 0 auto;
  line-height: 0;
}

.spell-dice-btn svg{
  width: 12px;
  height: 12px;
  display:block;
}

.spell-dice-btn:hover{
  background: rgba(80,170,255,.22);
}

.spell-dice-btn:active{
  transform: translateY(1px);
}
